<!doctype html>
<html>
	<head>

		<!-- stylesheets -->
		<link rel="stylesheet" type="text/css" href="assets/bootstrap.css"/>
		<link rel="stylesheet" type="text/css" href="assets/app.css"/>

	</head>
	<body data-ng-app="DeweyApp">

		<!-- container -->
		<div id="main" class="container-fluid">
			<div class="col-xs-12" data-ng-view></div>
		</div>

		<!-- inline templates -->
		<script type="text/ng-template" id="/login">
			<div class="login col-xs-12">
				<img id="logo" class="col-xs-12" src="assets/logo_transparent.png">
				<br>
				<span class="mission col-xs-12">find the right people</span>
				<br>
				<div class="col-xs-1"></div>
				<a href="#/search">
					<button type="button" class="col-xs-10 btn btn-default btn-lg">login</button>
				</a>
				<div class="col-xs-1"></div>
			</div>
		</script>
		<script type="text/ng-template" id="/search">
			<div ng-include src="'/navigation'"></div>
			<div ng-include src="'/list'"></div>
		</script>
		<script type="text/ng-template" id="/user">
			<div ng-include src="'/navigation'"></div>
			<div ng-include src="'/user_profile'"></div>
			<div ng-include src="'/tags'"></div>
		</script>
		<script type="text/ng-template" id="/topic">
			<div ng-include src="'/navigation'"></div>
			<div ng-include src="'/topic_profile'"></div>
			<div ng-include src="'/list'"></div>
		</script>
		<script type="text/ng-template" id="/navigation">
			<nav class="nav col-xs-12">
				<a href="#/search">
					<img id="logo" src="assets/logo.png">
				</a>
				<div class="col-xs-10">
					<div class="col-xs-12 input-group input-group-lg">
					  <input id="search" type="text" class="form-control" placeholder="search by topic or person">
					</div>
				</div>
			</nav>
		</script>
		<script type="text/ng-template" id="/list">
			<div class="list col-xs-12 list-group">
				<div ng-repeat="result in results">
				  <a href="#/user/{{ result.id }}" class="list-group-item">
				  	<img src="assets/picture_placeholder.png">
				  	<div class="col-xs-10">
					    <h4 class="list-group-item-heading">{{ result.first_name }}</h4>
					    <p class="list-group-item-text">{{ result.department }}</p>
				  	</div>
				  </a>
				</div>
			</div>
		</script>
		<script type="text/ng-template" id="/user_profile">
			<div class="profile col-xs-12">	
				<div class=circular-image>				
					<img src="assets/{{ user.image }}">
				</div>
				<div class="col-xs-12">
					<span class="name">{{ user.first_name }} {{ user.last_name }}</span>
					<br>
					<span class="description">{{ user.position }}</span>
					<br>
					<br>
					<span class="email">email: {{ user.email }}</span>
					<br>
					<span class="phone">phone: {{ user.phone }}</span>
				</div>
			</div>
		</script>
		<script type="text/ng-template" id="/topic_profile">
			<div class="profile col-xs-12">					
				<img src="assets/picture_placeholder.png">
				<div class="col-xs-12">
					<span class="name">{{ topic.name }}</span>
					<br>
					<span class="description">{{ topic.description }}</span>
				</div>
			</div>
		</script>
		<script type="text/ng-template" id="/tags">
			<div class="tags col-xs-12">
				<a href="#/topic">
					<span ng-repeat="tag in topics">{{ tag.name }}</span>
				</a>
			</div>
		</script>

		<!-- javascripts -->
		<script src="assets/angular.js"></script>
		<script src="assets/angular-route.js"></script>
		<script src="assets/jquery-1.11.0.js"></script>

		<script>
			var DeweyApp = angular.module('DeweyApp', ['ngRoute']);

			DeweyApp.config(function ($routeProvider) {
			  $routeProvider
			    .when('/', {
			    	controller: 'DeweyController',
			    	templateUrl: '/login'
			    })
			    .when('/search', {
			    	controller: 'DeweyController',
			    	templateUrl: '/search'
			    })
			    .when('/user', {
			    	controller: 'DeweyController',
			    	templateUrl: '/user'
			    })
			    .when('/user/:userId', {
			    	controller: 'DeweyController',
			    	templateUrl: '/user'
			    })
			    .when('/topic', {
			    	controller: 'DeweyController',
			    	templateUrl: '/topic'
			    })
			    .otherwise({ 
			    	redirectTo: '/'
			    });
			});

			DeweyApp.factory('DeweyFactory', function ($http) {

				var factory, user, users, topic, topics;
			  
			  factory = {};
				//results = [{name:"Veni Johanna",description:"Engineer"},{name:"Brett Solow",description:"Engineer"},{name:"Stephen Quinonez",description:"Engineer"},{name:"William Chidyausiku",description:"Engineer"},{name:"John Pulvera",description:"Engineer"},{name:"#full-stack",description:"4 people with this skill"}];
				user = {name: "Veni Johanna",description: "Engineer",email: "veni@stanford.edu",phone: "123-456-7890"};
				users = [{name:"Veni Johanna",description:"Engineer"},{name:"Brett Solow",description:"Engineer"},{name:"William Chidyausiku",description:"Engineer"},{name:"John Pulvera",description:"Engineer"}];
				topic = {name: "#full-stack",description: "4 people know this topic"};
				topics = [{name:"full-stack"},{name:"web"},{name:"programming"},{name:"iOS"},{name:"user growth"},{name:"algorithms"}];

				factory.getResults = function (callback) {
					$http.get("/users.json").success(callback);
				};

				factory.getUser = function (params, callback) {
					$http.get("/users/" + params.userId + ".json").success(callback);
					//return user;
				};

				factory.getUsers = function () {
					return users;
				};

				factory.getTopic = function () {
					return topic;
				};

				factory.getTopics = function () {
					return topics;
				};

			  return factory;
			});

			DeweyApp.controller('DeweyController', function ($scope, $routeParams, DeweyFactory) {

				DeweyFactory.getResults(function(results) {
					$scope.results = results;
				});

				if (!jQuery.isEmptyObject($routeParams)) {
					DeweyFactory.getUser($routeParams, function(user) {
						console.log(user);
						$scope.user = user;
					});
				}

				function init () {
					//$scope.results = DeweyFactory.getResults();
					//$scope.user = DeweyFactory.getUser();
					$scope.users = DeweyFactory.getUsers();
					$scope.topic = DeweyFactory.getTopic();
					$scope.topics = DeweyFactory.getTopics();
				}

				(function () {
					init();
				})();

			});
		</script>

	</body>
</html>